:root {
  --accent: #efbf8a;
  --accent2: #ee9282;
  --deep-bg: #2b2320;
  --paper: #f9f5f2;
  --emboss: 0 2px 5px #fff3, 0 1px 5px #d3a87488;
  --shadow: 0 6px 32px 0 #442b1477;
  --cat-glow: 0 0 40px 10px #fff1b890;
  --font-main: 'Noto Serif SC', 'Quicksand', serif;
  --font-logo: 'Pacifico', cursive;
}
* { margin:0; padding:0; box-sizing:border-box; }
html,body { height:100%; width:100%; background:var(--deep-bg); }
body { font-family:var(--font-main); background:var(--deep-bg); color:#fff; letter-spacing:0.01em; overflow:hidden; }
.hidden { display:none!important; }

#curtain {
  position:fixed; inset:0; background:#080702;
  z-index:9999;
  display:flex; justify-content:center; align-items:center;
  transition:opacity 1.4s cubic-bezier(.5,.1,.2,1); }
#start-button {
  font-family:var(--font-logo);
  font-size:clamp(2.2rem,5vw,3.5rem);
  color:#fff7;
  background:linear-gradient(100deg, #49423a 30%, #fff1ee38 100%);
  border: none;
  border-radius:40px; padding:1.2em 2.6em; cursor:pointer;
  box-shadow:var(--shadow); letter-spacing:.2em; 
  position:relative;
  overflow:hidden;
  filter:drop-shadow(0 2px 16px #fff8);
  transition:background .3s,color .3s;
  outline:none; isolation:isolate;
}
#start-button:hover { color:#fff; background:linear-gradient(100deg, #fffbeea2 0%, var(--accent) 100%); }
#start-button .start-flare {
  position:absolute; top:50%; left:55%; pointer-events:none;
  width:160px; height:50px; background:radial-gradient(circle at 70% 50%,#fff2a0cc 30%,#fd93 70%,transparent 100%);
  mix-blend-mode:soft-light; border-radius:50%;
  opacity:.95; box-shadow:0 0 40px 0 #ffd 80%;
  filter: blur(14px); transform:translate(-50%,-50%); 
  animation: flare-move 2.8s infinite linear;
}
@keyframes flare-move { 0%{left:49%; opacity:1;} 40%{opacity:.93;} 60%{left:61%; opacity:.97;} 100%{left:49%;opacity:1;} }

/* 故事书层 */
#background-3d {
  position:fixed; inset:0; z-index:-20; overflow:hidden; pointer-events:none;
}
#bg-canvas { position:absolute; inset:0; width:100vw; height:100vh; background:transparent; }
#ambient-glow {
  position:absolute; inset:0; background:
    radial-gradient(circle at 60% 55%, #ffe5c248 0%,transparent 28%),
    radial-gradient(circle at 80% 80%, #dfcfb288 0%, transparent 45%);
  pointer-events:none;
  mix-blend-mode:screen;
}
#bg-overlay {
  position:absolute; inset:0;
  background:linear-gradient(145deg, transparent 60%, #3333 100%), linear-gradient(5deg, #00000040 15%, transparent 60%);
  pointer-events:none;
  z-index:4;
}

#leaves-canvas {
  position:fixed; top:0; left:0; width:100vw; height:100vh; pointer-events:none; z-index:-10;
  filter: blur(.1px) contrast(108%);
}
.scene {
  min-height:calc(100vh - 0.1px); min-width:100vw;
  display:flex; align-items:center; justify-content:center;
  position:relative; scroll-snap-align:start; overflow:hidden;
}
.scene-intro {
  background:rgba(0,0,0,0.15); position:relative;
}
.intro-content {
  color:#fff; text-align:center; text-shadow:0 4px 30px #2e151188;
}
.intro-content h1 {
  font-size:clamp(2.8rem,6vw,5rem); letter-spacing:.07em; 
  font-family:var(--font-logo), var(--font-main); font-weight:700;
  filter:drop-shadow(0 4px 18px #fff5);
  text-shadow: var(--emboss);
  margin-bottom:.5em;
}
.subline { font-size:1.5rem; margin-bottom:2.7em; opacity:.78; font-family:var(--font-main);}
.scroll-indicator { margin:3em auto 0 auto; width:4em; }
.arrow {
  width:20px; height:20px; border:solid #fff; border-width:0 0 5px 5px;
  border-radius:2px;
  display:inline-block;
  transform:rotate(45deg); animation:arrowB 1.3s infinite cubic-bezier(.2,.7,.4,1.2);
  margin:0 auto;
}
@keyframes arrowB { 0%,100%{transform:translateY(0) rotate(45deg);} 40%{transform:translateY(10px) rotate(45deg);} }

.scene-main { background:rgba(230,205,183,.03); }
.composition {
  width:94vw; max-width:1160px;
  display:grid; grid-template-columns: 1fr 3fr 1fr;
  align-items:center;
  gap:2vw;
  justify-content:space-between;
  min-height:65vh;
}
.l-pane,.r-pane { display:flex; flex-direction:column; align-items:center;}
.c-pane { display:flex; flex-direction:column; justify-content:center; align-items:center;}
.cat { position:relative; cursor:pointer; user-select:none; }
#cat1 { width:23vw; min-width:180px; aspect-ratio:1.3; margin-right: min(2vw,30px); }
#gulu-cat { width:26vw; min-width:210px; aspect-ratio:1.15; margin-left:min(2vw,30px);}
.interactive svg { display:block; width:100%; height:auto; filter:var(--cat-glow) blur(.2px); z-index:3; }
.interactive:active svg { filter: drop-shadow(0 0 36px #fffad277) contrast(1.1); }
#gulu-cat .love-canvas { position:absolute; left:0;top:0;width:100%;height:100%; pointer-events:none; z-index:7;}
.cat .purr-bubble { pointer-events:none; }

.blessing-text { font-size:clamp(1.3rem,2.3vw,2.3rem); color: #fff9; border-radius:8px; margin:2vw 0 0 0; text-shadow:0 2px 6px #ad8d7288, 0 5px 30px #0009;}
.fade-in { opacity:0; transform:translateY(40px); transition: opacity .95s cubic-bezier(.7,.15,.15,1), transform .89s cubic-bezier(.7,.09,.27,1);}
.fade-in.is-visible {opacity:1;transform:translateY(0);}

.scene-letter {
  background: linear-gradient(120deg, #13111088 0%,  #efe2d840 100%);
  backdrop-filter:blur(8px);
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 -32px 60px #0005 inset;
  padding:10vh 0 10vh 0;
}
.letter-card {
  background:var(--paper); color:#4b2a19; margin:4vh auto;
  padding: 3.2vw 5vw; border-radius:18px; box-shadow:var(--shadow);
  font-size:1.7rem; line-height:1.9; font-family:var(--font-main);
  max-width:520px; width:91vw; 
  text-align:center; border:1.7px solid #f2e3d1bb;
  position:relative;
}
.letter-card h2 {
  font-family:var(--font-logo); color:var(--accent2);
  font-size:2.55em; margin-bottom:.75em;
  line-height:1.08em; letter-spacing:.17em;
}
.signature { color:var(--accent2); margin-top:2.7em;
  font-size:1.2em; text-align:right; font-family:var(--font-logo);
  filter:drop-shadow(0 0 11px #fff3);
}
@media (max-width:768px) {
  .composition { grid-template-columns: 1fr; }
  .l-pane,.r-pane { margin:0 0 6vw 0;}
  #cat1,#gulu-cat { width:60vw; min-width:140px;}
}

#music-toggle {
  position:fixed; bottom:26px; right:24px;
  width:54px; height:54px; border-radius:50%;
  background:rgba(230,205,183,0.20); color:var(--accent2);
  box-shadow:0 3px 24px #af8b6420;
  cursor:pointer; z-index:25;
  display:flex; justify-content:center; align-items:center;
  font-size:2.12rem;
  opacity:.8; transition:opacity .38s, background .2s;
  outline:none; border:none; filter:drop-shadow(0 2px 24px #fff3);
}
#music-toggle:hover { opacity:1; background: #efbf8a44; }
#music-toggle.playing { color: #ea604f; background: #fffbeea8; filter:drop-shadow(0 0 21px #ea604b60); }
#music-toggle .note { animation: musicpulse 3s infinite; }
@keyframes musicpulse { 60% { transform:scale(1.12) rotate(-8deg); color:var(--accent2);} }

.heart-spark{
  position: absolute;
  width: 22px; height: 19px;
  left:0;top:0;
  background: none;
  pointer-events: none;
  filter: drop-shadow(0 0 16px #ffecd7cc);
  z-index:55;
  opacity:1;
  animation: heartSparkle .95s cubic-bezier(.4,.65,.33,1.18) forwards;
}
.heart-spark svg {width:100%;height:100%;}
@keyframes heartSparkle {
  0% { opacity:1; transform: scale(.4) translateY(0) rotate(-16deg); }
  35%{ opacity:.97;}
  70%{ opacity:1; }
  90%{ opacity: .7; }
  100%{ opacity:0; transform:scale(1.26) translateY(-98px) rotate(80deg);}
}
/* 呼噜气泡 */
.purr-bubble {
  position: absolute;
  left: 40px; top: 22px; width: 22px; height: 22px;
  opacity: 0; z-index:40;
  animation: bubbleUp .9s cubic-bezier(.22,.88,.49,1.31) forwards;
}
@keyframes bubbleUp {
  0% { opacity: 0.1; transform: scale(.55) translateY(0);}
  25%{ opacity:.85;}
  70%{opacity:.89;}
  90%{opacity:0.7;}
  100% { opacity: 0; transform: scale(1.7) translateY(-32px);}
}
